<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>物资管理</title>
		<link href="../css/base.css" rel="stylesheet">
		<link rel="stylesheet" href="../custom/uimaker/easyui.css">
		<link rel="stylesheet" type="text/css" href="../custom/uimaker/icon.css">
		<link rel="stylesheet" href="../css/providers1.css">
		<script type="text/javascript" src="../custom/jquery.min.js"></script>
	    <script type="text/javascript" src="../custom/jquery.easyui.min.js"></script>
	    <script type="text/javascript" src="../custom/easyui-lang-zh_CN.js"></script>
	</head>
<body>
 	<div class="container" style="width:100%;">
       <table class="easyui-datagrid"  id="dgGoodsInfo" style="width:100%;"    data-options="
                rownumbers:true,
                singleSelect:false,
                autoRowHeight:false,
                pagination:true,
                fitColumns:true,
                striped:true,
                collapsible:true,
                toolbar:'#tb',
                pageSize:10,
                url:'../goodsInfo/findAllGoodsInfo.do'">
            <thead>
                <tr>
                	<th field="ck" checkbox="true" align="center" width="50px"></th>
                    <th field="g_code" align="center" width="50px">物品编码</th>
                    <th field="g_name" align="center" width="50px">物品名称</th>
                    <th field="gt_name" align="center" width="50px">物品类型</th>
                    <th field="g_price" align="center" width="50px">价格</th>
                    <th field="g_model" align="center" width="50px">物品型号</th>
                    <th field="g_format" align="center" width="50px">物品规格</th>
                    <th field="g_qualitytime" align="center" width="50px">保质期</th>
                    <th field="g_deptid" align="center" width="50px">所属部门（回收站/分拣站）</th>
                    <th field="g_stopflag" align="center" width="50px">可用状态</th>
                    <th field="remark" align="center" width="60px">备注</th>
                </tr>
            </thead>
        </table>
      <div id="tb" style="padding:0 30px;width:100%;">
        <div class="opt-buttons" style="width:100%;">
            <a href="javascript:newGoodsInfo()" class="easyui-linkbutton" data-options="selected:true">新增</a>
            <a href="javascript:updateGoodsInfo()" class="easyui-linkbutton">修改</a>
            <a href="javascript:deleteGoodsInfo()" class="easyui-linkbutton">删除</a>
            <a href="#" class="easyui-linkbutton">导出</a>
        	<div class="conditions" style="float:right;margin-right: 20px">
	          	<span class="con-span">物品名: </span>
	          	<input class="easyui-textbox" type="text" name="searchByName"  id="searchByName" style="width:166px;height:35px;line-height:35px;"></input>
	          	 <a href="javascript:searchGoodsInfoByName()" class="easyui-linkbutton" iconCls="icon-search" data-options="selected:true">查询</a>
       		</div>
        </div>
      </div>
    </div> 
    
    <!-- 用户操作form表单—START -->
	     <div id="dlg-buttons">
		      <a href="javascript:saveGoodsInfo()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
		      <a href="javascript: closeGoodsAddDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
		 </div> 
	    
	   	<div id="dlgGoodsInfo" class="easyui-dialog" style="width: 570px;height: 350px;padding: 10px 20px" closed="true" buttons="#dlg-buttons" closable="false">
		    <form id="formGoodsInfo" method="post">
		          <table cellspacing="5px">
			         <p><input type="hidden" id="g_id" name="g_id" /></p>
			         <tr>
			              <td>物品编码：</td>
			              <td><input type="text" id="g_code" name="g_code" class="easyui-validatebox" required="true"/></td>
			              <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
			              <td>物品名称：</td>
			              <td><input type="text" id="g_name" name="g_name" class="easyui-validatebox" required="true"/></td>
			         </tr> 
			         <tr> 
			              <td>物品价格：</td>
			              <td><input type="text" id="g_price" name="g_price" class="easyui-validatebox" required="true"/></td>
			              <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
			              <td>所属部门：</td>
			              <td><input type="text" id="g_deptid" name="g_deptid" class="easyui-validatebox" required="true"/></td>
			         </tr>
			         <tr>
			              <td>物品型号：</td>
			              <td><input type="text" id="g_model" name="g_model" class="easyui-validatebox" required="true"/></td>
			              <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
			              <td>物品规格：</td>
			              <td><input type="text" id="g_format" name="g_format" class="easyui-validatebox" required="true"/></td>
			         </tr>
			         <tr>     
			              <td>保质期：</td>
			              <td><input type="text" id="g_qualitytime" name="g_qualitytime" class="easyui-validatebox" required="true"/></td>
			              <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
			              <td>可用状态：</td>
			              <td><input type="text" id="g_stopflag" name="g_stopflag" class="easyui-validatebox" required="true"/></td>
			         </tr>
			         <tr>
			              <td>物品类型：</td>
			              <td>
				                   <input type="hidden" id="g_gtid" name="g_gtid"/>
				                   <input type="text" id="gt_name" name="gt_name" class="easyui-validatebox" required="true" readonly="readonly"/>
			              </td>
					               <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					               <td colspan="2"><a href="javascript:openGoodsDetailChooseDialog()" class="easyui-linkbutton">选择物品类型</a></td>
			         </tr>
			         <tr>
			              <td>备注：</td>
			              <td colspan="4">
			                     <textarea rows="7" cols="50" name="remark" id="remark"></textarea>
			              </td>
			         </tr>
			    </table>
	       </form>
	   </div>
	  <!-- 用户操作form表单—END -->  
    
    <div id="dlgGoodsDetailInfo" class="easyui-dialog" iconCls="icon-search" style="width: 500px;height: 480px;padding: 10px 20px" closed="true" buttons="#dlg2-buttons" title="请选择角色">
      <div style="height: 40px" align="center">
	                    角色名称：<input type="text" id="s_roleName" name="s_roleName" onkeydown="if(event.keyCode==13) searchGoodsDetail()"/>
	          <a href="javascript:searchGoodsDetail()" class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
	  </div>
      <div style="height: 350px;">
	       <table id="dgGoodsDetailInfo" title="查询结果" class="easyui-datagrid" fitColumns="true" pagination="true" rownumbers="true" fit="true" singleSelect="true" url="../goodsDetailInfo/findAllGoodsDetailInfo.do">
	            <thead>
				    <tr>
				          <th field="ck" checkbox="true" align="center" width="50px"></th>
				          <th field="gt_id" width="50" align="center">编号</th>
				          <th field="gt_name" width="100" align="center">物资名称</th>
				          <th field="gt_remark" width="50" align="center">备注</th>
				   </tr>
	      		</thead>
	    	</table>
		</div>
 	 </div>
    <div id="dlg2-buttons">
	      <a href="javascript:chooseGoodsDetail()" class="easyui-linkbutton" iconCls="icon-ok">确定</a>
	      <a href="javascript:closeGoodsDetailDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
	</div>   
 	<script type="text/javascript">
 		var newGoodsInfoUrl="../goodsInfo/saveGoodsInfo.do";
 		var updateGoodsInfoUrl="../goodsInfo/updateGoodsInfo.do"
 		var urls="";
 		/* 搜索按钮 */
 		function searchGoodsInfoByName() {
			$("#dgGoodsInfo").datagrid("load",{
				searchByName:$("#searchByName").val()
			})
		}
 		/* 添加用户按钮 */
 		function newGoodsInfo(){
 			$("#dlgGoodsInfo").dialog("open").dialog("setTitle","新增物品");
 			urls=newGoodsInfoUrl;
 		}
 		/* 打开物品类型按钮 */
 		function openGoodsDetailChooseDialog(){
 			$("#dlgGoodsDetailInfo").dialog("open");
 		}
 		
 		function searchGoodsDetail(){
 			$("#dgGoodsDetailInfo").datagrid("load",{
 				s_roleName:$("#s_roleName").val()
 			});
 		}
 		/* 选择一个角色 */
 		function chooseGoodsDetail(){
 			var row=$("#dgGoodsDetailInfo").datagrid("getSelected");
 			if(row==null){
 				$.messager.alert("系统提示","请选择一个物品类型","info");
 				return false;
 			}
 			$("#g_gtid").val(row.gt_id);
 			$("#gt_name").val(row.gt_name);
 			closeGoodsDetailDialog();
 		}
 		/* 关闭角色按钮 */
 		function closeGoodsDetailDialog(){
 			$("#dlgGoodsDetailInfo").dialog("close");
 		}
 		/* 添加用户的确认按钮 */
 		function saveGoodsInfo(){
 			
 			$("#formGoodsInfo").form("submit",{
 				
 				url:urls,
 	 			onsubmit:function(){
 	 				return $(this).form("validate");
 	 			},
 	 			success:function(result){
 	 				var result=eval('('+result+')');
 	 				if(result.msg){
 	 					$.messager.alert("系统提示","保存成功","info");
 	 					closeGoodsAddDialog();
 	 					$("#dgGoodsInfo").datagrid("reload");
 	 				}else{
 	 					$.messager.alert("系统提示","系统繁忙，请稍后再操作","info");
 	 				}		
 	 			}
 			})
 			
 		}
 		/* 添加用户的关闭按钮及清除表单 */
 		function closeGoodsAddDialog(){
 			$("#formGoodsInfo").form("clear");
 			$("#dlgGoodsInfo").dialog("close");
 		}
 		/* 添加用户时提示该用户存不存在    */
 		$("#g_code").blur(function(){
 			var g_code=$("#g_code").val();
 			$.ajax({
 				url:"../goodsInfo/findGoodsInfoByGCode.do",
 				type:"post",
 				dataType:"json",
 				data:{g_code:g_code},
 				success:function(result){
 					if(result.msg){
 						$.messager.alert("系统提示","当前物品编码存在","info");
 						$("#g_code").val("");
 					}
 				}
 			});
 		});
 		/* 修改用户 */
 		function updateGoodsInfo(){
 			var rows=$("#dgGoodsInfo").datagrid("getSelections");
 			alert(rows.length);
 			if(rows.length!=1){
 				$.messager.alert("系统提示","请选择一个物品","warning");
 				return false;
 			}
 			$("#formGoodsInfo").form("load",rows[0]);
 			$("#dlgGoodsInfo").dialog("open").dialog("setTitle","修改物品信息");
 			urls=updateGoodsInfoUrl;
 		}
 		/* 删除用户 */
 		function deleteGoodsInfo(){
 			var rows=$("#dgGoodsInfo").datagrid("getSelections");
 			alert(rows.length);
 			if(rows.length==0){
 				$.messager.alert("系统提示","请选择需要删除的物品","warning");
 				return false;
 			}
 			var goods_ids=[];
 			$.each(rows,function(index,row){
 				goods_ids.push(row.g_id);
 				alert(row.g_id)
 			});
 			var goodsIds=goods_ids.join(",");
 			alert(goodsIds);
 			$.messager.confirm("系统提示","确认删除<font size=5 color=red>'" + rows.length + "'</font>个物品？",function(r){
 				if(r){
 					$.ajax({
 						url:"../goodsInfo/deleteGoodsInfo.do",
 						type:"post",
 						dataType:"json",
 						data:{goodsIds:goodsIds},
 						success:function(result){
 							if(result.msg){
 		 	 					$.messager.alert("系统提示","删除成功","info");
 		 	 					closeGoodsAddDialog();
 		 	 					$("#dgGoodsInfo").datagrid("reload");
 		 	 				}else{
 		 	 					$.messager.alert("系统提示","系统繁忙，请稍后再操作","info");
 		 	 				}	
 						}
 					});
 				}
 			});
 		}
 	</script>
</body>
</html>